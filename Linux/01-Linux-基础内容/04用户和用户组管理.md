用户和用户组管理

> 在Linux如何创建用户和用户组？如何修改密码？用户信息都存放在哪里？如何查看？

用户和用户组管理，是添加用户和用户组、更改密码和设定权限等操作。

## 用户管理命令 ##

1. useradd - 创建新用户

**格式**

```shell
[root @ ~]# useradd [选项] 用户名
```
**选项&参数**

- `-c`	添加备注文字

- `-d`	新用户每次登陆时所使用的家目录

- `-e`	用户终止日期，日期的格式为YYYY-MM-DD

- `-f`	用户过期几日后永久停权。当值为0时用户立即被停权，而值为-1时则关闭此功能，预设值为-1

- `-g`	指定用户对应的用户组

- `-G`	定义此用户为多个不同组的成员

- `-m`	用户目录不存在时则自动创建

- `-M`	不建立用户家目录，优先于/etc/login.defs文件设定

- `-n`	取消建立以用户名称为名的群组

- `-r`	建立系统帐号

- `-u`	指定用户id

**说明**
1. Linux创建新用户有2种形式：默认创建 和 手工创建

- 默认创建

    直接运行 useradd + 用户名

- 手工创建
  
    在 useradd 带上选项 自行设定 UID、初始组、home目录、附加组、用户说明和用户登录shell

2. 默认创建
   
    在默认创建过程中，其实是依据默认模版完成用户基本信息创建。这个模版/etc/default/useradd.默认创建整个过程：
    - 在/etc/passwd中添加新用户
    - 在/etc/shadow中添加新用户密码信息，此时为!!即密码暂不可用
    - 在/etc/group中添加信用户信息，默认组为100。
    - 创建用户home目录及邮箱。分别在/home目录、/var/spool/mail查看

**示例**

```shell
#查看默认安装的模版文件
[root@centos7 ~]# vim /etc/default/useradd

#创建新用户
[root@centos7 ~]# useradd paulvim
    
#在/etc/passwd中查看创建新用户信息
paulvim:x:1000:1001::/home/paulvim:/bin/bash
```

2. passwd - 修改用户密码

**格式**
    
```shell
[root @ ~]# passwd [选项] 用户名
```

**选项&参数**

- -d	删除密码
- -l	锁定用户密码，无法被用户自行修改
- -u	解开已锁定用户密码，允许用户自行修改
- -e	密码立即过期，下次登陆强制修改密码
- -k	保留即将过期的用户在期满后能仍能使用
- -S	查询密码状态

**说明**

普通用户仅可以修改自己密码；root用户可以修改普通用户密码

3. 删除用户：userdel

**格式**

```shell
[root @ ~]# userdel [参数] [用户名]
```

**选项&参数**

- -f	强制删除用户账号
- -r	删除用户主目录及其中的任何文件


4. 切换用户身份：su

**格式**

    ```shell
    [root @ ~]# su [选项] [用户名]
    ```
**选项&参数**
- -l或--login	改变身份时，也同时变更工作目录，以及HOME,SHELL,USER,logname,此外，也会变更PATH变量

**格式**

    ```shell
    [root @ ~]# su [选项] [用户名]
    ```

## 用户组管理命令 ##

1. 添加用户组：groupadd


2. 删除用户组：groupdel


3. 修改用户组：groupmod

## 用户管理相关文件 ##

		1．用户的家目录
			普通用户的家目录位于/home/下，目录名和用户名相同
		2．用户邮箱目录
		3．用户模板目录
			模板目录就是/etc/skel/目录

## 用户配置文件 ##

### 用户信息文件/etc/passwd ###
		“:”作为分隔符，划分为7个字段
		1、用户名：
			Linux系统是通过用户ID（UID）来区分不同用户、分配用户权限的
		2、密码标识
			“x”代表的是密码标志，而不是真正的密码，真正的密码是保存在/etc/shadow文件中的
		3、UID
			0：超级用户UID
			1～499：系统用户（伪用户）UID用户是不能登录系统的，而是用来运行系统或服务的
			500～65535：普通用户UID
		4、GID
			用户的组ID（GID），也就是这个用户的初始组的标志号
			所谓初始组，指用户一登录就立刻拥有这个用户组的相关权限
			所谓附加组，指用户可以加入多个其他的用户组，并拥有这些组的权限
		5、用户说明
		6、家目录
		7、登录之后的Shell
			/bin/bash就代表这个用户拥有权限范围内的所有权限

### 影子文件/etc/shadow ###
		Linux系统把真正的加密密码串放置在影子文件/etc/shadow中，而影子文件的权限是000
		使用“:”作为分隔符，划分为9个字段
		1．用户名称
		2．密码
			目前Linux的密码采用的是SHA512散列加密算法，而原来采用的是MD5或DES加密算法
			所有伪用户的密码都是“! !”或“*”，代表没有密码是不能登录的
			可以在密码前人为地加入“!”或“*”改变加密值让密码暂时失效，使这个用户无法登录，达到暂时禁止用户登录的效果
		3．密码最后一次修改日期
			Linux更加习惯使用时间戳代表时间
			以1970年1月1日作为标准时间，每过去一天时间戳加1
		4．密码的两次修改间隔时间（和第三个字段相比）
		5．密码的有效期（和第三个字段相比）
		6．密码修改到期前的警告天数（和第五个字段相比）
		7．密码过期后的宽限天数（和第五个字段相比）
		8．账号失效时间
		9．保留

### 组信息文件/etc/group# ###
		用“:”作为分隔符，划分为4个字段
		1．组名
		2．组密码标志
			用户组密码主要是用来指定组管理员的
		3．组ID（GID）
		4．组中的用户

### 组密码文件/etc/gshadow ###
		这个文件就是保存组密码的文件
		“:”作为分隔符，把文件划分为4个字段

